<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEOSPARTA ‚Äî –ë–ò–¢–í–ê –ó–ê –ö–û–ô–ù–´</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap');

        body { 
            font-family: 'Oswald', sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            background: radial-gradient(circle, #2c0000 0%, #000000 100%); 
            color: #fff;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .container { 
            background: rgba(20, 20, 20, 0.95); 
            padding: 30px; 
            border: 2px solid #8b0000; 
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.5); 
            text-align: center; 
            width: 400px; 
            transform: scale(0);
            animation: spawn 0.5s cubic-bezier(0.17, 0.89, 0.32, 1.28) forwards;
            position: relative;
            z-index: 2;
            height: 80vh;
            display: flex;
            flex-direction: column;
        }

        @keyframes spawn { to { transform: scale(1); } }
        @keyframes fadeOut { from { transform: scale(1); opacity: 1; } to { transform: scale(0.8); opacity: 0; } }

        h2 { text-transform: uppercase; letter-spacing: 3px; color: #ff0000; text-shadow: 2px 2px 5px #000; margin-bottom: 20px; }

        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #444; background: #111; color: #fff; border-radius: 0; box-sizing: border-box; }

        button { width: 100%; padding: 15px; background: #8b0000; color: white; border: none; text-transform: uppercase; font-weight: bold; cursor: pointer; transition: 0.2s; clip-path: polygon(5% 0%, 100% 0%, 95% 100%, 0% 100%); outline: none; -webkit-tap-highlight-color: transparent; }
        button:hover { background: #ff0000; transform: translateY(-2px); }

        .hidden { display: none; }

        .tabs { display: flex; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { padding: 10px; font-size: 10px; clip-path: none; background: #333; flex: 1; min-width: 60px; }
        .tab-btn.active { background: #8b0000; }

        .tab-content { flex-grow: 1; overflow-y: auto; display: none; }
        .tab-content.active { display: block; }

        #clickerBtn { width: 180px; height: 180px; border-radius: 50%; background: url('https://img.icons8.com/ios-filled/100/ffffff/shield.png') center/50% no-repeat, #8b0000; border: 8px solid #5a0000; margin: 30px auto; transition: transform 0.05s, box-shadow 0.3s, border-color 0.3s; display: block; box-shadow: 0 0 20px rgba(139, 0, 0, 0.8); clip-path: none; outline: none; -webkit-tap-highlight-color: transparent; user-select: none; }
        #clickerBtn:active { transform: scale(0.92); }
        #clickerBtn:disabled { background-color: #222; border-color: #111; filter: grayscale(1); cursor: not-allowed; opacity: 0.5; }

        #score { font-size: 42px; color: #ff0000; display: block; margin-bottom: 10px; text-shadow: 0 0 20px rgba(255, 0, 0, 0.8); font-weight: bold; }
        #score small { font-size: 22px; opacity: 0.8; }

        .shop-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid #333; background: rgba(255,255,255,0.05); margin-bottom: 8px; transition: 0.3s; }
        .shop-item:hover { border-color: #ff0000; background: rgba(139, 0, 0, 0.2); }
        .buy-btn { width: 90px; padding: 8px; font-size: 10px; clip-path: none; border: 1px solid #ff0000; background: transparent; }

        #notification-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .notification { background: #1a1a1a; color: #fff; border-left: 5px solid #ff0000; padding: 15px 25px; margin-bottom: 10px; text-transform: uppercase; animation: slideIn 0.4s ease-out forwards; font-size: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .achievements-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .ach-card { background: rgba(0,0,0,0.4); border: 1px solid #333; padding: 10px; font-size: 11px; opacity: 0.3; transition: 0.3s; grayscale: 100%; }
        .ach-card.unlocked { opacity: 1; border-color: #ff0000; background: rgba(139, 0, 0, 0.1); grayscale: 0%; box-shadow: inset 0 0 10px rgba(255,0,0,0.2); }

        .rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; font-size: 11px; text-align: left; }
        .rank-item:nth-child(1) { color: #ffd700; background: rgba(255, 215, 0, 0.1); }

        /* Custom Modal UI */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 10000; visibility: hidden; opacity: 0; transition: 0.3s; }
        .modal-overlay.active { visibility: visible; opacity: 1; }
        .modal-box { background: #0a0a0a; border: 2px solid #8b0000; padding: 25px; text-align: center; width: 320px; box-shadow: 0 0 40px rgba(139, 0, 0, 0.6); }
        .modal-title { color: #ff0000; font-size: 20px; margin-bottom: 15px; letter-spacing: 2px; }
        .modal-desc { font-size: 14px; margin-bottom: 20px; line-height: 1.4; color: #ddd; }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btn { flex: 1; padding: 12px; cursor: pointer; font-family: 'Oswald', sans-serif; font-weight: bold; text-transform: uppercase; border: none; }
        .btn-yes { background: #8b0000; color: white; }
        .btn-no { background: #333; color: white; }

        .rank-progress-container { width: 100%; background: #222; height: 10px; margin: 10px 0; border: 1px solid #444; overflow: hidden; }
        .rank-progress-bar { height: 100%; background: #ff0000; width: 0%; transition: width 0.3s ease; box-shadow: 0 0 10px #ff0000; }

        /* Bank Styles */
        .bank-card { background: rgba(139, 0, 0, 0.1); border: 1px solid #8b0000; padding: 20px; margin-top: 10px; position: relative; }
        #bank-balance { font-size: 28px; color: #ffd700; display: block; margin: 10px 0; font-weight: bold; }
        #bank-timer { color: #ff0000; font-family: monospace; font-size: 18px; }

        .rating-tabs { display: flex; gap: 5px; margin-bottom: 10px; }
        .rating-tab-btn { padding: 5px; font-size: 9px; flex: 1; background: #222; border: 1px solid #444; color: #fff; cursor: pointer; }
        .rating-tab-btn.active { background: #8b0000; border-color: #ff0000; }

        .profile-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }

        /* Profile Styles */
        .profile-info-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 5px; border: 1px solid #8b0000; background: rgba(139, 0, 0, 0.05); box-shadow: inset 0 0 10px rgba(0,0,0,0.5); }
        .profile-info-label { font-size: 12px; color: #aaa; text-transform: uppercase; }
        .profile-info-value { font-size: 14px; font-weight: bold; color: #ff0000; text-shadow: 0 0 5px rgba(255,0,0,0.3); }

        .bank-sub-tabs { display: flex; border-bottom: 1px solid #8b0000; margin-bottom: 15px; }
        .bank-sub-btn { flex: 1; background: none; border: none; color: #888; padding: 10px; cursor: pointer; text-transform: uppercase; font-size: 12px; }
        .bank-sub-btn.active { color: #ff0000; border-bottom: 2px solid #ff0000; }
        
        #history-list { text-align: left; max-height: 150px; overflow-y: auto; font-size: 11px; margin-top: 10px; }
        .history-item { border-bottom: 1px solid #222; padding: 5px 0; color: #ccc; }

        /* Search Card Styles */
        .search-container { margin: 10px 0; display: flex; gap: 5px; }
        .search-card { background: #111; border: 2px solid #ff0000; padding: 20px; margin-top: 15px; position: relative; display: none; }
        .search-card.active { display: block; animation: spawn 0.4s ease forwards; }
        .search-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #ff0000; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; font-weight: bold; color: #fff; }
        .like-dislike-btns { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .vote-btn { background: none; border: 1px solid #444; color: #fff; padding: 5px 15px; font-size: 14px; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .vote-btn.liked { color: #44ff44; border-color: #44ff44; }
        .vote-btn.disliked { color: #ff4444; border-color: #ff4444; }
        
        .avatar-selection { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .avatar-option { width: 60px; height: 60px; border: 2px solid #444; cursor: pointer; border-radius: 5px; transition: 0.3s; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: #fff; }
        .avatar-option.selected { border-color: #ff0000; transform: scale(1.1); box-shadow: 0 0 10px #ff0000; }

        .auth-tabs { display: flex; border-bottom: 2px solid #8b0000; margin-bottom: 20px; }
        .auth-tab { flex: 1; padding: 15px; cursor: pointer; background: #111; color: #888; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .auth-tab.active { background: #8b0000; color: #fff; }
        .pass-wrapper { position: relative; width: 100%; }
        .toggle-pass-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #8b0000; cursor: pointer; font-size: 12px; width: auto; padding: 5px; clip-path: none; }

        /* Chat Styles */
        .chat-container { display: flex; flex-direction: column; height: 100%; }
        #chat-messages { flex-grow: 1; overflow-y: auto; padding: 5px; text-align: left; }
        .chat-msg { margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.03); border-left: 3px solid #8b0000; display: flex; align-items: center; gap: 10px; }
        .chat-avatar { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #ff0000; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; flex-shrink: 0; }
        .chat-content { flex-grow: 1; }
        .chat-header { display: flex; gap: 5px; font-size: 10px; margin-bottom: 2px; }
        .chat-nick { font-weight: bold; }
        .chat-rank { color: #888; }
        .chat-text { font-size: 12px; word-break: break-all; color: #ddd; }
        .chat-input-area { display: flex; gap: 5px; padding-top: 10px; border-top: 1px solid #333; }
    </style>
</head>
<body>

<div id="notification-container"></div>

<div id="custom-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-title" id="m-title">–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï</div>
        <div class="modal-desc" id="m-desc"></div>
        <div class="modal-btns">
            <button class="modal-btn btn-yes" id="m-yes">–ü–†–ò–ù–Ø–¢–¨</button>
            <button class="modal-btn btn-no" id="m-no">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>
</div>

<div id="auth-screen" class="container" style="height: auto;">
    <div class="auth-tabs">
        <div id="tab-login" class="auth-tab active" onclick="setAuthMode('login')">–í–û–ô–¢–ò</div>
        <div id="tab-reg" class="auth-tab" onclick="setAuthMode('reg')">–ù–û–í–´–ô –ì–ï–†–û–ô</div>
    </div>
    <h2 id="auth-title">–í–û–ô–¢–ò –í –¢–ê–í–ï–†–ù–£</h2>
    <input type="text" id="username" placeholder="–ü–û–ó–´–í–ù–û–ô (3-12 –°–ò–ú–í–û–õ–û–í)">
    <div class="pass-wrapper">
        <input type="password" id="password" placeholder="–ü–ê–†–û–õ–¨">
        <button type="button" class="toggle-pass-btn" onclick="togglePassVisibility('password')">–ü–û–ö–ê–ó–ê–¢–¨</button>
    </div>
    <button id="main-auth-btn">–í–°–¢–£–ü–ò–¢–¨ –í –ë–û–ô</button>
</div>

<div id="game-screen" class="container hidden">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('clicker-tab')">–ë–ò–¢–í–ê</button>
        <button class="tab-btn" onclick="openTab('shop-tab')">–ê–†–°–ï–ù–ê–õ</button>
        <button class="tab-btn" onclick="openTab('bank-tab')">–ë–ê–ù–ö</button>
        <button class="tab-btn" onclick="openTab('profile-tab')">–ü–†–û–§–ò–õ–¨</button>
        <button class="tab-btn" onclick="openTab('rating-tab')">–†–ï–ô–¢–ò–ù–ì</button>
        <button class="tab-btn" onclick="openTab('chat-tab')">–ß–ê–¢</button>
        <button class="tab-btn hidden" id="admin-tab-btn" onclick="openTab('admin-tab')">–ê–î–ú–ò–ù–ö–ê</button>
    </div>

    <div id="clicker-tab" class="tab-content active">
        <h2 id="display-rank">–†–ï–ö–†–£–¢</h2>
        <div class="rank-progress-container">
            <div id="rank-progress-bar" class="rank-progress-bar"></div>
        </div>
        <div id="rank-info" style="font-size: 10px; color: #aaa; margin-bottom: 5px;">–î–û –°–õ–ï–î–£–Æ–©–ï–ì–û –ó–í–ê–ù–ò–Ø: 0/0 SC</div>
        <span id="score">0<small>.000</small></span>
        <button id="clickerBtn"></button>
        <div style="font-size: 14px; color: #888; margin-top: 10px;">
            –£–†–û–ù: <span id="stat-click" style="color:#ff0000">0.010</span> | –ê–í–¢–û: <span id="stat-auto">0.000</span>
        </div>
        <div style="font-size: 14px; color: #888; margin-top: 10px;">
            –ë–£–°–¢: <span id="stat-boost" style="color:#ff0000">1.0</span>x
        </div>
    </div>

    <div id="shop-tab" class="tab-content">
        <h3 style="color:#ff0000; text-transform: uppercase;">–£–õ–£–ß–®–ï–ù–ò–Ø</h3>
        <h4 style="border-bottom: 1px solid #8b0000; padding-bottom: 5px;">–£–†–û–ù (–ö–õ–ò–ö)</h4>
        <div id="click-upgrades-list"></div>
        <h4 style="border-bottom: 1px solid #8b0000; padding-bottom: 5px; margin-top: 20px;">–ê–†–ú–ò–Ø (–ê–í–¢–û)</h4>
        <div id="auto-upgrades-list"></div>
    </div>

    <div id="bank-tab" class="tab-content">
        <h3 style="color:#ff0000; text-transform: uppercase;">–ë–ê–ù–ö –°–ü–ê–†–¢–´</h3>
        <div class="bank-sub-tabs">
            <button class="bank-sub-btn active" onclick="switchBankTab('deposit')">–í–ö–õ–ê–î</button>
            <button class="bank-sub-btn" onclick="switchBankTab('transfer')">–ü–ï–†–ï–í–û–î–´</button>
        </div>
        
        <div id="bank-deposit-view" class="bank-card">
            <small>–í–ê–® –ë–ê–õ–ê–ù–° –í –ë–ê–ù–ö–ï</small>
            <span id="bank-balance">0 SC</span>
            <div id="bank-timer">15:00</div>
            <p style="font-size: 12px; margin: 10px 0;">–°–¢–ê–í–ö–ê: <span id="bank-percent" style="color:#ff0000">3</span>%</p>
            <p style="font-size: 11px; color: #888;">–õ–ò–ú–ò–¢ –í–ö–õ–ê–î–ê: <span id="bank-limit" style="color:#ff0000">100</span> SC</p>
            <p style="font-size: 11px; color: #888;">–ü–û–õ–£–ß–ï–ù–û –° –ü–†–û–¶–ï–ù–¢–û–í: <br><span id="bank-profit-total" style="color:#ffd700">0</span> SC</p>
            <div style="display: flex; gap: 5px; margin-top: 15px;">
                <input type="number" id="deposit-amount" placeholder="–°–£–ú–ú–ê" style="margin: 0;">
                <button id="depositBtn" style="width: 100px; padding: 10px; font-size: 10px;">–í–ù–ï–°–¢–ò</button>
            </div>
            <button id="withdrawBtn" style="margin-top: 10px; background: #333; font-size: 12px; padding: 10px;">–°–ù–Ø–¢–¨ –° –ë–ê–ù–ö–ê</button>
        </div>

        <div id="bank-transfer-view" class="bank-card hidden">
            <small>–ü–ï–†–ï–í–û–î –° –ë–ê–ù–ö–û–í–°–ö–û–ì–û –°–ß–ï–¢–ê</small>
            <input type="text" id="transfer-id" placeholder="ID –ü–û–õ–£–ß–ê–¢–ï–õ–Ø">
            <input type="number" id="transfer-amount" placeholder="–°–£–ú–ú–ê –ü–ï–†–ï–í–û–î–ê">
            <button id="transferBtn" style="padding: 10px; font-size: 12px;">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            <h5 style="margin: 15px 0 5px 0; color: #8b0000; text-align: left; text-transform: uppercase;">–ò–°–¢–û–†–ò–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô</h5>
            <div id="history-list"></div>
        </div>
    </div>

    <div id="profile-tab" class="tab-content">
        <h3 style="color:#ff0000; text-transform: uppercase;">–õ–ò–ß–ù–û–ï –î–ï–õ–û</h3>
        <div id="profile-main-view">
            <div class="search-container">
                <input type="text" id="search-player-id" placeholder="–ü–û–ò–°–ö –ü–û ID" style="margin:0; font-size:12px;">
                <button id="searchPlayerBtn" style="width:80px; padding:10px; font-size:10px;">–ù–ê–ô–¢–ò</button>
            </div>

            <div id="search-result-card" class="search-card">
                <button id="closeSearchBtn" style="position:absolute; right:10px; top:10px; width:20px; padding:0; background:none; color:#888;">‚úï</button>
                <div class="search-avatar" id="search-res-avatar"></div>
                <div id="search-res-name" style="font-weight:bold; color:#ff0000; font-size:18px;"></div>
                <div id="search-res-id" style="font-size:10px; color:#666; margin-bottom:10px;"></div>
                <div id="search-res-rank" style="font-size:12px; color:#aaa;"></div>
                <div id="search-res-ach" style="font-size:10px; color:#888; margin-top:5px; font-style:italic;"></div>
                <div class="like-dislike-btns">
                    <button class="vote-btn" id="like-btn">üëç <span id="like-count">0</span></button>
                    <button class="vote-btn" id="dislike-btn">üëé <span id="dislike-count">0</span></button>
                </div>
            </div>

            <div class="profile-info-row">
                <span class="profile-info-label">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†:</span>
                <span class="profile-info-value" id="prof-id"></span>
            </div>
            <div class="profile-info-row">
                <span class="profile-info-label">–ü–û–ó–´–í–ù–û–ô:</span>
                <span class="profile-info-value" id="prof-nick"></span>
            </div>
            <div class="profile-info-row">
                <span class="profile-info-label">–ö–ê–ó–ù–ê:</span>
                <span class="profile-info-value" id="prof-balance">0 SC</span>
            </div>
            <div class="profile-info-row">
                <span class="profile-info-label">–ë–ê–ù–ö:</span>
                <span class="profile-info-value" id="prof-bank" style="color:#ffd700">0 SC</span>
            </div>
            <div class="profile-info-row">
                <span class="profile-info-label">–£–†–û–í–ï–ù–¨:</span>
                <span class="profile-info-value" id="prof-level">1</span>
            </div>
            <div class="profile-info-row">
                <span class="profile-info-label">–†–ï–ô–¢–ò–ù–ì:</span>
                <span class="profile-info-value" id="prof-votes">üëç 0 | üëé 0</span>
            </div>
            
            <div style="margin-top: 10px; text-align: left; font-size: 11px; color: #888;">
                –¶–ï–ù–ê –ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–Ø: <span id="rebirth-cost" style="color:#ff0000">500</span> SC
            </div>
            <div class="profile-actions">
                <button id="rebirthBtn" style="padding: 10px; font-size: 11px;">–ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ï</button>
                <button id="settingsBtn" style="background:#444; padding: 10px; font-size: 11px;">–ù–ê–°–¢–†–û–ô–ö–ò</button>
            </div>
            <button id="resetAllBtn" style="background:#222; margin-top: 10px; width: 100%; padding: 10px; font-size: 11px; color: #555;">–°–ë–†–û–°–ò–¢–¨ –í–°–Å</button>
        </div>

        <div id="profile-settings-view" class="hidden">
            <h4 style="color: #ff0000; border-bottom: 1px solid #8b0000; padding-bottom: 5px;">–ò–ó–ú–ï–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•</h4>
            <div class="avatar-selection">
                <div class="avatar-option" id="av-male" onclick="selectAvatar('male')">–ú</div>
                <div class="avatar-option" id="av-female" onclick="selectAvatar('female')">–ñ</div>
            </div>
            <input type="text" id="settings-new-nick" placeholder="–ù–û–í–´–ô –ù–ò–ö–ù–ï–ô–ú">
            <input type="password" id="settings-new-pass" placeholder="–ù–û–í–´–ô –ü–ê–†–û–õ–¨">
            <div class="profile-actions">
                <button id="saveSettingsBtn" style="padding: 10px; font-size: 11px;">–°–û–•–†–ê–ù–ò–¢–¨</button>
                <button id="backProfileBtn" style="background:#444; padding: 10px; font-size: 11px;">–ù–ê–ó–ê–î</button>
            </div>
        </div>

        <h3 style="color:#ff0000; text-transform: uppercase; font-size: 18px; margin-top: 20px;">–î–û–°–¢–ò–ñ–ï–ù–ò–Ø</h3>
        <div id="achievements-list" class="achievements-grid"></div>
    </div>

    <div id="rating-tab" class="tab-content">
        <h3 style="color:#ff0000; text-transform: uppercase;">–ó–ê–õ –°–õ–ê–í–´</h3>
        <div class="rating-tabs">
            <button class="rating-tab-btn active" onclick="switchRating('score')">–ë–ê–õ–ê–ù–°</button>
            <button class="rating-tab-btn" onclick="switchRating('level')">–£–†–û–í–ï–ù–¨</button>
            <button class="rating-tab-btn" onclick="switchRating('treasuryBalance')">–ë–ê–ù–ö</button>
            <button class="rating-tab-btn" onclick="switchRating('bankProfitTotal')">–ü–†–ò–ë–´–õ–¨</button>
        </div>
        <div id="rating-list"></div>
    </div>

    <div id="chat-tab" class="tab-content">
        <div class="chat-container">
            <h3 style="color:#ff0000; text-transform: uppercase; margin: 0 0 10px 0;">–ì–õ–û–ë–ê–õ–¨–ù–´–ô –ß–ê–¢</h3>
            <div id="chat-messages"></div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="–ù–ê–ü–ò–®–ò–¢–ï –°–û–û–ë–©–ï–ù–ò–ï..." style="margin:0;">
                <button id="chatSendBtn" style="width:70px; padding:10px; font-size:10px;">–û–¢–ü–†.</button>
            </div>
        </div>
    </div>

    <div id="admin-tab" class="tab-content">
        <h3 style="color:#ff0000; text-transform: uppercase;">–ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê</h3>
        <input type="text" id="admin-target-id" placeholder="ID –¶–ï–õ–ò">
        <input type="number" id="admin-amount" placeholder="–°–£–ú–ú–ê (–î–õ–Ø –í–´–î–ê–ß–ò)">
        <div class="profile-actions" style="grid-template-columns: 1fr 1fr;">
            <button id="admin-give-sc" style="padding:10px; font-size:11px;">–í–´–î–ê–¢–¨ SC</button>
            <button id="admin-ban-user" style="padding:10px; font-size:11px; background:#444;">–ë–ê–ù</button>
            <button id="admin-unban-user" style="padding:10px; font-size:11px; background:#444;">–†–ê–ó–ë–ê–ù</button>
            <button id="admin-mute-user" style="padding:10px; font-size:11px; background:#444;">–ú–£–¢</button>
            <button id="admin-unmute-user" style="padding:10px; font-size:11px; background:#444;">–†–ê–ó–ú–£–¢</button>
            <button id="admin-del-user" style="padding:10px; font-size:11px; background:#000;">–£–î–ê–õ–ò–¢–¨</button>
        </div>
    </div>
    
    <button id="logoutBtn" style="margin-top:15px; background:#222; width:auto; padding:8px 20px; font-size:10px; align-self: center;">–û–¢–°–¢–£–ü–ò–¢–¨</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get, child, update, onValue, remove, push, limitToLast, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD7EYFt3UkEeFK0dNCm-Rmmual83psBhqI",
      authDomain: "neosparta-66dbd.firebaseapp.com",
      databaseURL: "https://neosparta-66dbd-default-rtdb.europe-west1.firebasedatabase.app/", 
      projectId: "neosparta-66dbd",
      storageBucket: "neosparta-66dbd.firebasestorage.app",
      messagingSenderId: "112474867859",
      appId: "1:112474867859:web:907638ce429d48fe78e566"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let score = 0, clickPower = 0.001, autoPower = 0, level = 1, userId = "", boost = 1;
    let treasuryBalance = 0, treasuryStartTime = 0, bankProfitTotal = 0, lastSaveTime = 0;
    let unlockedAch = [];
    let currentUsername = "";
    let currentPassword = "";
    let currentRatingType = "score";
    let transferHistory = [];
    let currentGender = "male";
    let likes = 0, dislikes = 0;
    let myVotes = {}; // { targetNick: 'like' | 'dislike' }
    let isBanned = false, isMuted = false, isAdmin = false;

    let clickTimes = [];
    const MAX_CPS = 15;

    let authClicks = 0;
    let authClickTimer = null;

    document.getElementById('auth-title').addEventListener('click', () => {
        authClicks++;
        clearTimeout(authClickTimer);
        authClickTimer = setTimeout(() => { authClicks = 0; }, 1000);
        if (authClicks >= 5) {
            isAdmin = true;
            notify("–ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê");
            authClicks = 0;
        }
    });

    const avatars = {
        male: '–ú',
        female: '–ñ'
    };

    const upgrades = [
        { id: 1, name: "–ö–ò–ù–ñ–ê–õ", cost: 1000, power: 0.001, type: "click" },
        { id: 2, name: "–ú–ï–ß", cost: 3000, power: 0.005, type: "click" },
        { id: 3, name: "–ö–û–ü–¨–ï", cost: 5000, power: 0.010, type: "click" },
        { id: 4, name: "–©–ò–¢", cost: 7000, power: 0.015, type: "click" },
        { id: 5, name: "–Ø–†–û–°–¢–¨", cost: 9000, power: 0.025, type: "click" },
        { id: 6, name: "–ú–û–õ–û–¢", cost: 11000, power: 0.035, type: "click" },
        { id: 7, name: "–¢–û–ü–û–†", cost: 13000, power: 0.050, type: "click" },
        { id: 8, name: "–†–ê–ë", cost: 1000, power: 0.001, type: "auto" },
        { id: 9, name: "–õ–£–ß–ù–ò–ö", cost: 3000, power: 0.005, type: "auto" },
        { id: 10, name: "–ì–û–ü–õ–ò–¢", cost: 5000, power: 0.010, type: "auto" },
        { id: 11, name: "–í–°–ê–î–ù–ò–ö", cost: 7000, power: 0.015, type: "auto" },
        { id: 12, name: "–ì–ï–†–û–ô", cost: 9000, power: 0.025, type: "auto" },
        { id: 13, name: "–ú–ê–ì–ò–°–¢–†", cost: 11000, power: 0.035, type: "auto" },
        { id: 14, name: "–õ–ï–ì–ò–û–ù", cost: 13000, power: 0.050, type: "auto" },
        { id: 15, name: "–ë–û–ì –í–û–ô–ù–´", cost: 15000, power: 0.080, type: "auto" }
    ];

    const achievementData = [
        { id: 'ach50', goal: 50, name: "–†–Ø–î–û–í–û–ô", desc: "–°–û–ë–†–ê–ù–û 50 SC" },
        { id: 'ach100', goal: 100, name: "–í–û–ò–ù", desc: "–°–û–ë–†–ê–ù–û 100 SC" },
        { id: 'ach500', goal: 500, name: "–¶–ï–ù–¢–£–†–ò–û–ù", desc: "–°–û–ë–†–ê–ù–û 500 SC" },
        { id: 'ach1000', goal: 1000, name: "–õ–ï–ì–ê–¢", desc: "–°–û–ë–†–ê–ù–û 1–∫ SC" },
        { id: 'ach5000', goal: 5000, name: "–ü–û–õ–ö–û–í–û–î–ï–¶", desc: "–°–û–ë–†–ê–ù–û 5–∫ SC" },
        { id: 'ach10000', goal: 10000, name: "–ü–û–õ–£–ë–û–ì", desc: "–°–û–ë–†–ê–ù–û 1–∫ SC" },
        { id: 'achU1', goal: 1, name: "–û–†–£–ñ–ï–ù–û–°–ï–¶", desc: "–ö–£–ü–õ–ï–ù–û 1 –£–õ–£–ß–®–ï–ù–ò–ï", type: "upg" },
        { id: 'achU2', goal: 2, name: "–°–ù–ê–†–Ø–ñ–ï–ù–ù–´–ô", desc: "–ö–£–ü–õ–ï–ù–û 2 –£–õ–£–ß–®–ï–ù–ò–Ø", type: "upg" },
        { id: 'achU3', goal: 3, name: "–í–ï–¢–ï–†–ê–ù", desc: "–ö–£–ü–õ–ï–ù–û 3 –£–õ–£–ß–®–ï–ù–ò–Ø", type: "upg" },
        { id: 'achU4', goal: 4, name: "–ú–ê–°–¢–ï–†", desc: "–ö–£–ü–õ–ï–ù–û 4 –£–õ–£–ß–®–ï–ù–ò–Ø", type: "upg" },
        { id: 'achU5', goal: 5, name: "–¢–ò–¢–ê–ù", desc: "–ö–£–ü–õ–ï–ù–û 5 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU6', goal: 6, name: "–†–ê–ó–†–£–®–ò–¢–ï–õ–¨", desc: "–ö–£–ü–õ–ï–ù–û 6 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU7', goal: 7, name: "–ë–ï–°–°–ú–ï–†–¢–ù–´–ô", desc: "–ö–£–ü–õ–ï–ù–û 7 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU8', goal: 8, name: "–ü–û–í–ï–õ–ò–¢–ï–õ–¨", desc: "–ö–£–ü–õ–ï–ù–û 8 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU9', goal: 9, name: "–î–ï–ú–ò–£–†–ì", desc: "–ö–£–ü–õ–ï–ù–û 9 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU10', goal: 10, name: "–ë–û–ì", desc: "–ö–£–ü–õ–ï–ù–û 10 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU11', goal: 11, name: "–í–õ–ê–î–´–ö–ê", desc: "–ö–£–ü–õ–ï–ù–û 11 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU12', goal: 12, name: "–ò–ú–ü–ï–†–ê–¢–û–†", desc: "–ö–£–ü–õ–ï–ù–û 12 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU13', goal: 13, name: "–ê–ë–°–û–õ–Æ–¢", desc: "–ö–£–ü–õ–ï–ù–û 13 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU14', goal: 14, name: "–í–ï–ß–ù–´–ô", desc: "–ö–£–ü–õ–ï–ù–û 14 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achU15', goal: 15, name: "–ù–ï–û–°–ü–ê–†–¢–ê–ù–ï–¶", desc: "–ö–£–ü–õ–ï–ù–û 15 –£–õ–£–ß–®–ï–ù–ò–ô", type: "upg" },
        { id: 'achB3', goal: 3, name: "–†–ê–ó–û–ì–†–ï–í", desc: "–ë–£–°–¢ –î–û–°–¢–ò–ì 3x", type: "boost" },
        { id: 'achB5', goal: 5, name: "–ü–´–õ –ë–ò–¢–í–´", desc: "–ë–£–°–¢ –î–û–°–¢–ò–ì 5x", type: "boost" },
        { id: 'achB10', goal: 10, name: "–Ø–†–û–°–¢–¨ –°–ü–ê–†–¢–´", desc: "–ë–£–°–¢ –î–û–°–¢–ò–ì 10x", type: "boost" }
    ];

    const ranks = ["–†–ï–ö–†–£–¢", "–û–ü–û–õ–ß–ï–ù–ï–¶", "–í–û–ò–ù", "–í–ï–¢–ï–†–ê–ù", "–¶–ï–ù–¢–£–†–ò–û–ù", "–õ–ï–ì–ê–¢", "–ü–†–ï–¢–û–†–ò–ê–ù–ï–¶", "–ü–û–õ–ö–û–í–û–î–ï–¶", "–¢–ò–¢–ê–ù", "–ë–û–ì –í–û–ô–ù–´"];
    const percentSteps = [3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 24, 26, 28, 30];

    function getRank(lvl) {
        return ranks[Math.min(Math.floor((lvl - 1) / 1), 9)];
    }

    function getTreasuryPercent(lvl) {
        return percentSteps[Math.min(lvl - 1, percentSteps.length - 1)];
    }

    function getBankLimit(lvl) {
        return lvl * 100;
    }

    function formatValue(num) {
        if (!num) return "0";
        if (num >= 1000000000000) return (num / 1000000000000).toFixed(2) + '—Ç—Ä–ª–¥';
        if (num >= 1000000) return (num / 1000000).toFixed(2) + '–º';
        if (num >= 1000) return (num / 1000).toFixed(1) + '–∫';
        return Math.floor(num).toString();
    }

    function formatPower(num) {
        const integerPart = Math.floor(num);
        const fractionalPart = (num % 1).toFixed(3).substring(2);
        return `${integerPart}.${fractionalPart}`;
    }

    function formatScore(num) {
        const integerPart = Math.floor(num);
        const fractionalPart = (num % 1).toFixed(3).substring(2);
        if (num >= 1000) return formatValue(num);
        return `${integerPart}<small>.${fractionalPart}</small>`;
    }

    function openConfirm(title, desc, callback) {
        const modal = document.getElementById('custom-modal');
        document.getElementById('m-title').innerText = title;
        document.getElementById('m-desc').innerText = desc;
        modal.classList.add('active');
        document.getElementById('m-yes').onclick = () => {
            callback();
            modal.classList.remove('active');
        };
        document.getElementById('m-no').onclick = () => modal.classList.remove('active');
    }

    window.openTab = function(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if (event) event.currentTarget.classList.add('active');
        if (tabId === 'rating-tab') fetchRating();
        if (tabId === 'bank-tab') fetchHistory();
        if (tabId === 'chat-tab') listenChat();
    };

    window.switchRating = function(type) {
        currentRatingType = type;
        document.querySelectorAll('.rating-tab-btn').forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('onclick').includes(type));
        });
        fetchRating();
    };

    window.switchBankTab = function(type) {
        document.querySelectorAll('.bank-sub-btn').forEach(btn => btn.classList.toggle('active', btn.getAttribute('onclick').includes(type)));
        document.getElementById('bank-deposit-view').classList.toggle('hidden', type !== 'deposit');
        document.getElementById('bank-transfer-view').classList.toggle('hidden', type !== 'transfer');
        if (type === 'transfer') fetchHistory();
    };

    function notify(text) {
        const el = document.createElement('div');
        el.className = 'notification';
        el.innerText = text;
        document.getElementById('notification-container').appendChild(el);
        setTimeout(() => el.remove(), 2500);
    }

    async function saveData() {
        if (!currentUsername) return;
        lastSaveTime = Date.now();
        update(ref(db, 'users/' + currentUsername), { 
            score, clickPower, autoPower, level, userId, unlockedAch, 
            upgradesCosts: upgrades.map(u => u.cost),
            treasuryBalance, treasuryStartTime, bankProfitTotal, lastSaveTime,
            password: currentPassword, gender: currentGender, likes, dislikes,
            myVotes, isBanned, isMuted, bannedBy: isBanned ? (window.bannedBy || "ADMIN") : null
        });
    }

    function fetchRating() {
        const ratingList = document.getElementById('rating-list');
        onValue(ref(db, 'users'), (snapshot) => {
            const data = snapshot.val();
            const sorted = Object.keys(data)
                .map(key => ({ name: key, ...data[key] }))
                .sort((a, b) => (b[currentRatingType] || 0) - (a[currentRatingType] || 0))
                .slice(0, 50);

            ratingList.innerHTML = "";
            sorted.forEach((user, index) => {
                const item = document.createElement('div');
                item.className = 'rank-item';
                let valStr = formatValue(user[currentRatingType] || 0);
                if (currentRatingType === 'level') valStr = "LVL " + (user.level || 1);
                else valStr += " SC";
                
                const nickColor = user.gender === 'female' ? '#ff00ff' : '#ff8c00';
                item.innerHTML = `<div>#${index + 1} <span style="color:${nickColor}">${user.name}</span> <br><small>[${getRank(user.level || 1)}]</small></div> <div style="text-align:right">ID: ${user.userId || '?'}<br><small style="color:#ff0000">${valStr}</small></div>`;
                ratingList.appendChild(item);
            });
        }, { onlyOnce: true });
    }

    window.selectAvatar = function(gender) {
        currentGender = gender;
        document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
        document.getElementById(`av-${gender}`).classList.add('selected');
    };

    document.getElementById('searchPlayerBtn').onclick = async () => {
        const sId = document.getElementById('search-player-id').value.trim();
        if (!sId) return;

        const usersSnapshot = await get(child(ref(db), 'users'));
        const users = usersSnapshot.val();
        let target = null;
        let targetNick = "";

        for (let nick in users) {
            if (users[nick].userId === sId) {
                target = users[nick];
                targetNick = nick;
                break;
            }
        }

        if (target) {
            const card = document.getElementById('search-result-card');
            document.getElementById('search-res-name').innerText = targetNick;
            document.getElementById('search-res-name').style.color = target.gender === 'female' ? '#ff00ff' : '#ff8c00';
            document.getElementById('search-res-id').innerText = `ID: ${target.userId}`;
            document.getElementById('search-res-rank').innerText = `–ó–í–ê–ù–ò–ï: ${getRank(target.level || 1)}`;
            document.getElementById('search-res-avatar').innerText = avatars[target.gender || 'male'];
            document.getElementById('search-res-ach').innerText = `–î–û–°–¢–ò–ñ–ï–ù–ò–ô: ${target.unlockedAch ? target.unlockedAch.length : 0}`;
            document.getElementById('like-count').innerText = target.likes || 0;
            document.getElementById('dislike-count').innerText = target.dislikes || 0;
            
            const btnLike = document.getElementById('like-btn');
            const btnDislike = document.getElementById('dislike-btn');

            const updateVotesUI = () => {
                btnLike.classList.toggle('liked', myVotes[targetNick] === 'like');
                btnDislike.classList.toggle('disliked', myVotes[targetNick] === 'dislike');
            };
            updateVotesUI();

            btnLike.onclick = async () => {
                if (targetNick === currentUsername) return notify("–°–ï–ë–Ø –õ–ê–ô–ö–ê–¢–¨ –ù–ï–õ–¨–ó–Ø!");
                let l = target.likes || 0;
                let d = target.dislikes || 0;

                if (myVotes[targetNick] === 'like') {
                    l--; delete myVotes[targetNick];
                } else {
                    if (myVotes[targetNick] === 'dislike') d--;
                    l++; myVotes[targetNick] = 'like';
                }
                target.likes = l; target.dislikes = d;
                await update(ref(db, `users/${targetNick}`), { likes: l, dislikes: d });
                document.getElementById('like-count').innerText = l;
                document.getElementById('dislike-count').innerText = d;
                updateVotesUI();
                saveData();
            };

            btnDislike.onclick = async () => {
                if (targetNick === currentUsername) return notify("–°–ï–ë–Ø –•–ï–ô–¢–ò–¢–¨ –ù–ï–õ–¨–ó–Ø!");
                let l = target.likes || 0;
                let d = target.dislikes || 0;

                if (myVotes[targetNick] === 'dislike') {
                    d--; delete myVotes[targetNick];
                } else {
                    if (myVotes[targetNick] === 'like') l--;
                    d++; myVotes[targetNick] = 'dislike';
                }
                target.likes = l; target.dislikes = d;
                await update(ref(db, `users/${targetNick}`), { likes: l, dislikes: d });
                document.getElementById('like-count').innerText = l;
                document.getElementById('dislike-count').innerText = d;
                updateVotesUI();
                saveData();
            };

            card.classList.add('active');
        } else notify("–ò–ì–†–û–ö –ù–ï –ù–ê–ô–î–ï–ù!");
    };

    document.getElementById('closeSearchBtn').onclick = () => {
        document.getElementById('search-result-card').classList.remove('active');
    };

    function updateStats() {
        document.getElementById('score').innerHTML = formatScore(score);
        document.getElementById('stat-click').innerText = formatPower(clickPower);
        document.getElementById('stat-auto').innerText = formatPower(autoPower);
        document.getElementById('stat-boost').innerText = boost.toFixed(1);
        document.getElementById('prof-nick').innerText = currentUsername;
        document.getElementById('prof-nick').style.color = currentGender === 'female' ? '#ff00ff' : '#ff8c00';
        document.getElementById('prof-balance').innerText = formatValue(score) + " SC";
        document.getElementById('prof-bank').innerText = formatValue(treasuryBalance) + " SC";
        document.getElementById('prof-level').innerText = level;
        document.getElementById('prof-id').innerText = userId;
        document.getElementById('prof-votes').innerText = `üëç ${likes} | üëé ${dislikes}`;
        document.getElementById('display-rank').innerText = getRank(level);
        document.getElementById('bank-balance').innerText = formatValue(treasuryBalance) + " SC";
        document.getElementById('bank-percent').innerText = getTreasuryPercent(level);
        document.getElementById('bank-profit-total').innerText = formatValue(bankProfitTotal);
        document.getElementById('bank-limit').innerText = formatValue(getBankLimit(level));

        const rebCost = Math.min(500 * Math.pow(5, level - 1), 100000000);
        document.getElementById('rebirth-cost').innerText = formatValue(rebCost);
        
        const progressPercent = Math.min((score / rebCost) * 100, 100);
        document.getElementById('rank-progress-bar').style.width = progressPercent + '%';
        document.getElementById('rank-info').innerText = `–î–û –°–õ–ï–î–£–Æ–©–ï–ì–û –ó–í–ê–ù–ò–Ø: ${formatValue(score)} / ${formatValue(rebCost)} SC`;

        const btn = document.getElementById('clickerBtn');
        const intensity = Math.min(score / 10000, 1);
        btn.style.boxShadow = `0 0 ${20 + intensity * 60}px rgba(255, ${intensity * 50}, 0, ${0.5 + intensity * 0.5})`;
        btn.style.borderColor = `rgb(${90 + intensity * 165}, ${intensity * 100}, 0)`;
        btn.style.transform = `scale(${1 + intensity * 0.15})`;

        checkAchievements();
    }

    function checkAchievements() {
        achievementData.forEach(ach => {
            if (!unlockedAch.includes(ach.id)) {
                if (!ach.type && score >= ach.goal) {
                    unlockedAch.push(ach.id);
                    notify(`–î–û–°–¢–ò–ñ–ï–ù–ò–ï: ${ach.name}`);
                    renderAchievements();
                    saveData();
                } else if (ach.type === "upg") {
                    const boughtCount = upgrades.filter(u => u.bought).length;
                    if (boughtCount >= ach.goal) {
                        unlockedAch.push(ach.id);
                        notify(`–î–û–°–¢–ò–ñ–ï–ù–ò–ï: ${ach.name}`);
                        renderAchievements();
                        saveData();
                    }
                } else if (ach.type === "boost") {
                    if (boost >= ach.goal) {
                        unlockedAch.push(ach.id);
                        notify(`–î–û–°–¢–ò–ñ–ï–ù–ò–ï: ${ach.name}`);
                        renderAchievements();
                        saveData();
                    }
                }
            }
        });
    }

    function renderAchievements() {
        const list = document.getElementById('achievements-list');
        list.innerHTML = "";
        achievementData.forEach(ach => {
            const isUnlocked = unlockedAch.includes(ach.id);
            const card = document.createElement('div');
            card.className = `ach-card ${isUnlocked ? 'unlocked' : ''}`;
            card.innerHTML = `<strong>${ach.name}</strong><br>${ach.desc}`;
            list.appendChild(card);
        });
    }

    function renderShop() {
        const clickList = document.getElementById('click-upgrades-list');
        const autoList = document.getElementById('auto-upgrades-list');
        clickList.innerHTML = "";
        autoList.innerHTML = "";
        upgrades.forEach(upg => {
            const item = document.createElement('div');
            item.className = 'shop-item';
            item.innerHTML = `<div style="text-align:left"><b>${upg.name}</b><br><small>+${formatPower(upg.power)} ${upg.type === 'click' ? '–ö–õ–ò–ö' : '–ê–í–¢–û'}</small></div> <div><small style="color:#ff0000">${formatValue(upg.cost)} SC</small></div>`;
            const btn = document.createElement('button');
            btn.className = 'buy-btn';
            btn.innerText = '–ö–£–ü–ò–¢–¨';
            btn.onclick = () => {
                if (score >= upg.cost) {
                    score -= upg.cost;
                    if (upg.type === "click") clickPower += upg.power;
                    else autoPower += upg.power;
                    upg.cost = Math.floor(upg.cost * 1.6);
                    upg.bought = true;
                    updateStats();
                    renderShop();
                    saveData();
                    notify("–°–ù–ê–†–Ø–ñ–ï–ù–ò–ï –ü–û–õ–£–ß–ï–ù–û!");
                } else notify("–ù–£–ñ–ù–û –ë–û–õ–¨–®–ï –ó–û–õ–û–¢–ê!");
            };
            item.appendChild(btn);
            if (upg.type === "click") clickList.appendChild(item);
            else autoList.appendChild(item);
        });
    }

    function fetchHistory() {
        const list = document.getElementById('history-list');
        onValue(ref(db, `transfers/${userId}`), (snapshot) => {
            list.innerHTML = "";
            const data = snapshot.val();
            if (data) {
                const arr = Object.values(data).reverse().slice(0, 10);
                arr.forEach(tr => {
                    const el = document.createElement('div');
                    el.className = 'history-item';
                    const type = tr.from === userId ? '–û–¢–ü–†–ê–í–õ–ï–ù–û' : '–ü–û–õ–£–ß–ï–ù–û';
                    const color = tr.from === userId ? '#ff4444' : '#44ff44';
                    el.innerHTML = `<span style="color:${color}">${type}</span>: ${formatValue(tr.amount)} SC (${tr.from === userId ? 'ID:'+tr.to : 'ID:'+tr.from})`;
                    list.appendChild(el);
                });
            }
        });
    }

    function listenChat() {
        const chatBox = document.getElementById('chat-messages');
        const chatQuery = query(ref(db, 'chat'), limitToLast(30));
        onValue(chatQuery, (snap) => {
            chatBox.innerHTML = "";
            snap.forEach((childSnap) => {
                const msg = childSnap.val();
                const div = document.createElement('div');
                div.className = 'chat-msg';
                const color = msg.gender === 'female' ? '#ff00ff' : '#ff8c00';
                div.innerHTML = `
                    <div class="chat-avatar" style="border-color:${color}">${avatars[msg.gender || 'male']}</div>
                    <div class="chat-content">
                        <div class="chat-header">
                            <span class="chat-nick" style="color:${color}">${msg.user}</span>
                            <span class="chat-rank">[${getRank(msg.level || 1)}]</span>
                        </div>
                        <div class="chat-text">${msg.text}</div>
                    </div>
                `;
                chatBox.appendChild(div);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    }

    document.getElementById('chatSendBtn').onclick = () => {
        if (isMuted) return notify("–£ –í–ê–° –ú–£–¢!");
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;
        push(ref(db, 'chat'), {
            user: currentUsername,
            text: text,
            gender: currentGender,
            level: level,
            time: Date.now()
        });
        input.value = "";
    };

    window.setAuthMode = function(mode) {
        const title = document.getElementById('auth-title');
        const loginTab = document.getElementById('tab-login');
        const regTab = document.getElementById('tab-reg');
        if (mode === 'login') {
            title.innerText = "–í–û–ô–¢–ò –í –¢–ê–í–ï–†–ù–£";
            loginTab.classList.add('active');
            regTab.classList.remove('active');
        } else {
            title.innerText = "–ù–û–í–´–ô –ì–ï–†–û–ô";
            regTab.classList.add('active');
            loginTab.classList.remove('active');
        }
    };

    window.togglePassVisibility = function(id) {
        const input = document.getElementById(id);
        const btn = event.target;
        if (input.type === 'password') {
            input.type = 'text';
            btn.innerText = '–°–ö–†–´–¢–¨';
        } else {
            input.type = 'password';
            btn.innerText = '–ü–û–ö–ê–ó–ê–¢–¨';
        }
    };

    async function attemptAuth(user, pass, isNew) {
        const dbRef = ref(db);
        const snapshot = await get(child(dbRef, `users/${user}`));

        if (!isNew) {
            if (snapshot.exists() && snapshot.val().password === pass) {
                const data = snapshot.val();
                if (data.isBanned) {
                    notify(`–í–´ –ë–´–õ–ò –ó–ê–ë–ê–ù–ï–ù–´ ¬´${data.bannedBy || 'ADMIN'}¬ª`);
                    return;
                }
                currentUsername = user;
                currentPassword = data.password;
                score = data.score || 0;
                clickPower = data.clickPower || 0.001;
                autoPower = data.autoPower || 0;
                level = data.level || 1;
                userId = data.userId || (Math.floor(1000 + Math.random() * 9000)).toString();
                unlockedAch = data.unlockedAch || [];
                treasuryBalance = data.treasuryBalance || 0;
                treasuryStartTime = data.treasuryStartTime || Date.now();
                bankProfitTotal = data.bankProfitTotal || 0;
                lastSaveTime = data.lastSaveTime || Date.now();
                currentGender = data.gender || "male";
                likes = data.likes || 0;
                dislikes = data.dislikes || 0;
                myVotes = data.myVotes || {};
                isBanned = data.isBanned || false;
                isMuted = data.isMuted || false;
                if(data.upgradesCosts) data.upgradesCosts.forEach((c, i) => { if(upgrades[i]) upgrades[i].cost = c; });
                
                localStorage.setItem('neo_user', user);
                localStorage.setItem('neo_pass', pass);

                const offlineSeconds = Math.floor((Date.now() - lastSaveTime) / 1000);
                if (offlineSeconds > 10 && autoPower > 0) {
                    const offlineIncome = (autoPower * offlineSeconds) * 0.5;
                    score += offlineIncome;
                    notify(`–û–§–§–õ–ê–ô–ù –î–û–•–û–î: ${formatValue(offlineIncome)} SC`);
                }
                enterGame();
            } else notify("–û–®–ò–ë–ö–ê: –ù–ï–í–ï–†–ù–´–ô –ü–û–ó–´–í–ù–û–ô –ò–õ–ò –ü–ê–†–û–õ–¨!");
        } else {
            if (user.length < 3 || user.length > 12) {
                notify("–ü–û–ó–´–í–ù–û–ô –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –û–¢ 3 –î–û 12 –°–ò–ú–í–û–õ–û–í!");
                return;
            }
            const forbidden = ["1234", "1234456789", "qwerty", "qwer", user.toLowerCase()];
            if (forbidden.includes(pass.toLowerCase())) {
                notify("–ü–ê–†–û–õ–¨ –°–õ–ò–®–ö–û–ú –ü–†–û–°–¢!");
                return;
            }
            if (snapshot.exists()) notify("–û–®–ò–ë–ö–ê: –ü–û–ó–´–í–ù–û–ô –£–ñ–ï –ó–ê–ù–Ø–¢!");
            else {
                const newId = (Math.floor(1000 + Math.random() * 9000)).toString();
                const now = Date.now();
                await set(ref(db, 'users/' + user), { password: pass, score: 0, clickPower: 0.001, autoPower: 0, level: 1, userId: newId, unlockedAch: [], treasuryBalance: 0, treasuryStartTime: now, bankProfitTotal: 0, lastSaveTime: now, gender: "male", likes: 0, dislikes: 0, myVotes: {}, isBanned: false, isMuted: false });
                currentUsername = user;
                currentPassword = pass;
                userId = newId;
                unlockedAch = [];
                treasuryBalance = 0;
                treasuryStartTime = now;
                bankProfitTotal = 0;
                currentGender = "male";
                likes = 0;
                dislikes = 0;
                myVotes = {};
                isBanned = false;
                isMuted = false;
                
                localStorage.setItem('neo_user', user);
                localStorage.setItem('neo_pass', pass);
                enterGame();
            }
        }
    }

    document.getElementById('main-auth-btn').addEventListener('click', () => {
        const user = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value.trim();
        const mode = document.getElementById('auth-title').innerText;
        if (!user || !pass) {
            notify("–û–®–ò–ë–ö–ê: –ó–ê–ü–û–õ–ù–ò–¢–ï –í–°–ï –ü–û–õ–Ø!");
            return;
        }
        attemptAuth(user, pass, mode !== "–í–û–ô–¢–ò –í –¢–ê–í–ï–†–ù–£");
    });

    async function getPlayerByAnyId(id) {
        const snap = await get(child(ref(db), 'users'));
        const users = snap.val();
        for (let nick in users) {
            if (users[nick].userId === id) return { nick, data: users[nick] };
        }
        return null;
    }

    document.getElementById('admin-give-sc').onclick = async () => {
        const id = document.getElementById('admin-target-id').value.trim();
        const amount = parseFloat(document.getElementById('admin-amount').value);
        const player = await getPlayerByAnyId(id);
        if (player) {
            await update(ref(db, `users/${player.nick}`), { score: amount });
            notify(`–ë–ê–õ–ê–ù–° –£–°–¢–ê–ù–û–í–õ–ï–ù: ${formatValue(amount)} SC`);
        } else notify("–ò–ì–†–û–ö –ù–ï –ù–ê–ô–î–ï–ù");
    };

    document.getElementById('admin-ban-user').onclick = async () => {
        const id = document.getElementById('admin-target-id').value.trim();
        const player = await getPlayerByAnyId(id);
        if (player) {
            await update(ref(db, `users/${player.nick}`), { isBanned: true, bannedBy: currentUsername });
            notify("–ò–ì–†–û–ö –ó–ê–ë–ê–ù–ï–ù");
        }
    };

    document.getElementById('admin-unban-user').onclick = async () => {
        const id = document.getElementById('admin-target-id').value.trim();
        const player = await getPlayerByAnyId(id);
        if (player) {
            await update(ref(db, `users/${player.nick}`), { isBanned: false, bannedBy: null });
            notify("–ò–ì–†–û–ö –†–ê–ó–ë–ê–ù–ï–ù");
        }
    };

    document.getElementById('admin-mute-user').onclick = async () => {
        const id = document.getElementById('admin-target-id').value.trim();
        const player = await getPlayerByAnyId(id);
        if (player) {
            await update(ref(db, `users/${player.nick}`), { isMuted: true });
            notify("–ò–ì–†–û–ö –ó–ê–ú–£–ß–ï–ù");
        }
    };

    document.getElementById('admin-unmute-user').onclick = async () => {
        const id = document.getElementById('admin-target-id').value.trim();
        const player = await getPlayerByAnyId(id);
        if (player) {
            await update(ref(db, `users/${player.nick}`), { isMuted: false });
            notify("–ò–ì–†–û–ö –†–ê–ó–ú–£–ß–ï–ù");
        }
    };

    document.getElementById('admin-del-user').onclick = async () => {
        const id = document.getElementById('admin-target-id').value.trim();
        const player = await getPlayerByAnyId(id);
        if (player) {
            await remove(ref(db, `users/${player.nick}`));
            notify("–ò–ì–†–û–ö –£–î–ê–õ–ï–ù");
        }
    };

    function updateTreasury() {
        const now = Date.now();
        const fifteenMinutes = 15 * 60 * 1000;
        const elapsed = now - treasuryStartTime;
        if (elapsed >= fifteenMinutes) {
            const cycles = Math.floor(elapsed / fifteenMinutes);
            const percent = getTreasuryPercent(level) / 100;
            const limit = getBankLimit(level);
            for(let i = 0; i < cycles; i++) {
                const profit = treasuryBalance * percent;
                if (treasuryBalance + profit <= limit) {
                    treasuryBalance += profit;
                    bankProfitTotal += profit;
                } else if (treasuryBalance < limit) {
                    const diff = limit - treasuryBalance;
                    treasuryBalance = limit;
                    bankProfitTotal += diff;
                }
            }
            treasuryStartTime = now - (elapsed % fifteenMinutes);
            saveData();
        }
        const remaining = fifteenMinutes - (now - treasuryStartTime);
        const mins = Math.floor(remaining / 60000);
        const secs = Math.floor((remaining % 60000) / 1000);
        document.getElementById('bank-timer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        document.getElementById('bank-balance').innerText = formatValue(treasuryBalance) + " SC";
    }

    document.getElementById('depositBtn').onclick = () => {
        const amount = parseFloat(document.getElementById('deposit-amount').value);
        const limit = getBankLimit(level);
        if (amount > 0 && score >= amount) {
            if (treasuryBalance + amount <= limit) {
                score -= amount;
                treasuryBalance += amount;
                document.getElementById('deposit-amount').value = "";
                updateStats();
                saveData();
                notify("–ó–û–õ–û–¢–û –í –ë–ê–ù–ö–ï!");
            } else notify("–ü–†–ï–í–´–®–ï–ù –õ–ò–ú–ò–¢ –ë–ê–ù–ö–ê!");
        } else notify("–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í –í –ö–ê–ó–ù–ï!");
    };

    document.getElementById('withdrawBtn').onclick = () => {
        if (treasuryBalance > 0) {
            score += treasuryBalance;
            treasuryBalance = 0;
            updateStats();
            saveData();
            notify("–ë–ê–ù–ö–û–í–°–ö–ò–ô –°–ß–ï–¢ –û–ü–£–°–¢–û–®–ï–ù!");
        }
    };

    document.getElementById('transferBtn').onclick = async () => {
        const targetId = document.getElementById('transfer-id').value.trim();
        const amount = parseFloat(document.getElementById('transfer-amount').value);
        
        if (targetId === userId) {
            notify("–û–®–ò–ë–ö–ê: –ü–ï–†–ï–í–û–î –°–ï–ë–ï –ó–ê–ü–†–ï–©–ï–ù!");
            return;
        }
        if (isNaN(amount) || amount <= 0) {
            notify("–û–®–ò–ë–ö–ê: –ù–ï–í–ï–†–ù–ê–Ø –°–£–ú–ú–ê!");
            return;
        }
        if (treasuryBalance < amount) {
            notify("–û–®–ò–ë–ö–ê: –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í –í –ë–ê–ù–ö–ï!");
            return;
        }

        const dbRef = ref(db);
        const usersSnapshot = await get(child(dbRef, 'users'));
        const users = usersSnapshot.val();
        let targetUser = null;
        let targetUsername = "";

        for (let username in users) {
            if (users[username].userId === targetId) {
                targetUser = users[username];
                targetUsername = username;
                break;
            }
        }

        if (!targetUser) {
            notify("–û–®–ò–ë–ö–ê: –ü–û–õ–£–ß–ê–¢–ï–õ–¨ –ù–ï –ù–ê–ô–î–ï–ù!");
            return;
        }

        treasuryBalance -= amount;
        const targetNewBalance = (targetUser.treasuryBalance || 0) + amount;
        
        await update(ref(db, `users/${targetUsername}`), { treasuryBalance: targetNewBalance });
        await saveData();
        
        const trData = { from: userId, to: targetId, amount: amount, time: Date.now() };
        await push(ref(db, `transfers/${userId}`), trData);
        await push(ref(db, `transfers/${targetId}`), trData);
        
        document.getElementById('transfer-id').value = "";
        document.getElementById('transfer-amount').value = "";
        updateStats();
        notify("–ü–ï–†–ï–í–û–î –£–°–ü–ï–®–ù–û –í–´–ü–û–õ–ù–ï–ù!");
    };

    function enterGame() {
        updateStats();
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        if (isAdmin) document.getElementById('admin-tab-btn').classList.remove('hidden');
        selectAvatar(currentGender);
        renderShop();
        renderAchievements();
        setInterval(() => {
            if (autoPower > 0) {
                score += (autoPower / 10) * boost;
                updateStats();
            }
            if (boost > 1) {
                boost = Math.max(1, boost - 0.02);
                updateStats();
            }
            updateTreasury();
        }, 100);
        setInterval(saveData, 15000);
    }

    document.getElementById('clickerBtn').onclick = () => {
        const now = Date.now();
        clickTimes.push(now);
        clickTimes = clickTimes.filter(t => now - t < 1000);

        if (clickTimes.length > MAX_CPS) {
            const btn = document.getElementById('clickerBtn');
            btn.disabled = true;
            const penalty = score * 0.8;
            score -= penalty;
            notify(`–û–ë–ù–ê–†–£–ñ–ï–ù –ê–í–¢–û–ö–õ–ò–ö–ï–†! –®–¢–†–ê–§: ${formatValue(penalty)} SC. –ë–õ–û–ö–ò–†–û–í–ö–ê 30 –°–ï–ö–£–ù–î!`);
            updateStats();
            saveData();
            setTimeout(() => {
                btn.disabled = false;
                clickTimes = [];
                notify("–ö–ù–û–ü–ö–ê –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê.");
            }, 30000);
            return;
        }

        score += clickPower * boost;
        boost = Math.min(1 + (level * 2), boost + 0.2);
        updateStats();
    };

    document.getElementById('rebirthBtn').onclick = () => {
        const rebCost = Math.min(500 * Math.pow(5, level - 1), 100000000);
        openConfirm("–ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ï", `–ü–ï–†–ï–†–û–ñ–î–ï–ù–ò–ï ‚Äî –≠–¢–û –°–ë–†–û–° –¢–ï–ö–£–©–ï–ì–û –ü–†–û–ì–†–ï–°–°–ê –í –û–ë–ú–ï–ù –ù–ê –ù–û–í–´–ô –£–†–û–í–ï–ù–¨, –£–í–ï–õ–ò–ß–ï–ù–ù–£–Æ –°–¢–ê–í–ö–£ –í –ë–ê–ù–ö–ï –ò –ü–û–í–´–®–ï–ù–ù–£–Æ –°–ò–õ–£ –£–î–ê–†–ê.`, () => {
            if (score >= rebCost) {
                level++;
                score = 0;
                clickPower = level === 2 ? 0.005 : (level >= 3 ? 0.010 : 0.001);
                autoPower = 0;
                upgrades.forEach((u, i) => {
                    const baseCosts = [1000, 3000, 5000, 7000, 9000, 11000, 13000, 1000, 3000, 5000, 7000, 9000, 11000, 13000, 15000];
                    u.cost = baseCosts[i];
                    u.bought = false;
                });
                updateStats();
                renderShop();
                saveData();
                notify("–ù–û–í–ê–Ø –≠–†–ê!");
            } else notify("–ú–ê–õ–û –°–ò–õ!");
        });
    };

    document.getElementById('resetAllBtn').onclick = async () => {
        openConfirm("–ü–û–õ–ù–´–ô –°–ë–†–û–°", "–°–ë–†–û–°–ò–¢–¨ –í–°–Å ‚Äî –≠–¢–û –ü–û–õ–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –í–°–ï–ì–û –í–ê–®–ï–ì–û –ò–ì–†–û–í–û–ì–û –ü–†–û–ì–†–ï–°–°–ê –ë–ï–ó –í–û–ó–ú–û–ñ–ù–û–°–¢–ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø. –í–´ –ù–ê–ß–ù–ï–¢–ï –° –ù–£–õ–Ø –ö–ê–ö –ù–û–í–´–ô –†–ï–ö–†–£–¢.", async () => {
            score = 0; clickPower = 0.001; autoPower = 0; level = 1; unlockedAch = []; treasuryBalance = 0; treasuryStartTime = Date.now(); bankProfitTotal = 0;
            upgrades.forEach((u, i) => {
                const baseCosts = [1000, 3000, 5000, 7000, 9000, 11000, 13000, 1000, 3000, 5000, 7000, 9000, 11000, 13000, 15000];
                u.cost = baseCosts[i]; u.bought = false;
            });
            await saveData();
            updateStats(); renderShop(); renderAchievements(); notify("–û–ë–ù–£–õ–ï–ù–û!");
        });
    };

    document.getElementById('settingsBtn').onclick = () => {
        document.getElementById('profile-main-view').classList.add('hidden');
        document.getElementById('profile-settings-view').classList.remove('hidden');
    };

    document.getElementById('backProfileBtn').onclick = () => {
        document.getElementById('profile-main-view').classList.remove('hidden');
        document.getElementById('profile-settings-view').classList.add('hidden');
    };

    document.getElementById('saveSettingsBtn').onclick = async () => {
        const newNick = document.getElementById('settings-new-nick').value.trim();
        const newPass = document.getElementById('settings-new-pass').value.trim();
        
        if (newNick && newNick !== currentUsername) {
            if (newNick.length < 3 || newNick.length > 12) {
                notify("–ü–û–ó–´–í–ù–û–ô –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –û–¢ 3 –î–û 12 –°–ò–ú–í–û–õ–û–í!");
                return;
            }
            const snapshot = await get(child(ref(db), `users/${newNick}`));
            if (snapshot.exists()) {
                notify("–û–®–ò–ë–ö–ê: –ù–ò–ö –ó–ê–ù–Ø–¢!");
                return;
            }
            
            const oldDataSnapshot = await get(child(ref(db), `users/${currentUsername}`));
            const data = oldDataSnapshot.val();
            if (newPass) {
                const forbidden = ["1234", "1234456789", "qwerty", "qwer", newNick.toLowerCase()];
                if (forbidden.includes(newPass.toLowerCase())) {
                    notify("–ü–ê–†–û–õ–¨ –°–õ–ò–®–ö–û–ú –ü–†–û–°–¢!");
                    return;
                }
                data.password = newPass;
            }
            data.gender = currentGender;
            
            await set(ref(db, 'users/' + newNick), data);
            await remove(ref(db, 'users/' + currentUsername));
            currentUsername = newNick;
            if (newPass) {
                currentPassword = newPass;
                localStorage.setItem('neo_pass', newPass);
            }
            localStorage.setItem('neo_user', newNick);
            notify("–î–ê–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–´!");
        } else {
            if (newPass) {
                const forbidden = ["1234", "1234456789", "qwerty", "qwer", currentUsername.toLowerCase()];
                if (forbidden.includes(newPass.toLowerCase())) {
                    notify("–ü–ê–†–û–õ–¨ –°–õ–ò–®–ö–û–ú –ü–†–û–°–¢!");
                    return;
                }
                currentPassword = newPass;
                localStorage.setItem('neo_pass', newPass);
            }
            await saveData();
            notify("–ü–ê–†–û–õ–¨ –ò –ü–û–õ –°–û–•–†–ê–ù–ï–ù–´!");
        }
        
        document.getElementById('settings-new-nick').value = "";
        document.getElementById('settings-new-pass').value = "";
        updateStats();
        document.getElementById('backProfileBtn').click();
    };

    document.getElementById('logoutBtn').onclick = () => {
        localStorage.removeItem('neo_user');
        localStorage.removeItem('neo_pass');
        location.reload();
    };

    window.addEventListener('DOMContentLoaded', () => {
        const savedUser = localStorage.getItem('neo_user');
        const savedPass = localStorage.getItem('neo_pass');
        if (savedUser && savedPass) {
            attemptAuth(savedUser, savedPass, false);
        }
    });
</script>
</body>
</html>

